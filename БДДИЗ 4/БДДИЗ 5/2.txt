1. Проверка пересечения рейсов для каждого водителя


Вариант 1 (через JOIN)

SELECT r1.Водитель, r1.Идентификатор, r2.Идентификатор, r1.Дата_и_время_отправления, r1.Дата_и_время_прибытия, r2.Дата_и_время_отправления, r2.Дата_и_время_прибытия
FROM Рейсы r1
JOIN Рейсы r2 
    ON r1.Водитель = r2.Водитель 
   AND r1.Идентификатор <> r2.Идентификатор
   AND (
       r1.Дата_и_время_отправления BETWEEN r2.Дата_и_время_отправления AND r2.Дата_и_время_прибытия
       OR r1.Дата_и_время_прибытия BETWEEN r2.Дата_и_время_отправления AND r2.Дата_и_время_прибытия
   );

Вариант 2 (через подзапрос)

SELECT r1.Водитель, r1.Идентификатор, r2.Идентификатор
FROM Рейсы r1
WHERE EXISTS (
    SELECT 1
    FROM Рейсы r2
    WHERE r1.Водитель = r2.Водитель
    AND r1.Идентификатор <> r2.Идентификатор
    AND (
       r1.Дата_и_время_отправления BETWEEN r2.Дата_и_время_отправления AND r2.Дата_и_время_прибытия
       OR r1.Дата_и_время_прибытия BETWEEN r2.Дата_и_время_отправления AND r2.Дата_и_время_прибытия
    )
);

При JOIN база данных напрямую связывает таблицы и выполняет фильтрацию на основе индексов из-за чего выполняется быстрее.
Вариант с EXISTS менее эффективен, так как вызывает подзапрос для каждой строки.

SELECT *
FROM Рейсы
WHERE Пункт_отправления = 'Москва'
AND EXTRACT(EPOCH FROM (Дата_и_время_прибытия - Дата_и_время_отправления)) > 3 * 3600
ORDER BY Дата_и_время_отправления;

SELECT r.*
FROM Рейсы r
JOIN Водители v ON r.Водитель = v.Водитель_ID
JOIN Транспортные_средства ts ON v.Номер_ТС = ts.Гос_номерной_знак
WHERE ts.Марка = 'MAN';

SELECT ФИО
FROM Водители v
WHERE NOT EXISTS (
    SELECT 1
    FROM Рейсы r
    WHERE r.Водитель = v.Водитель_ID
    AND DATE(r.Дата_и_время_отправления) = CURRENT_DATE
);
